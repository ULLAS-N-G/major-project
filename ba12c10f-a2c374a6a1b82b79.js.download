"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8803],{23736:(e,t,r)=>{r.d(t,{$o:()=>H,AQ:()=>P,Di:()=>_,IO:()=>tq,J_:()=>eT,gt:()=>J,mt:()=>eh,nV:()=>eg,ng:()=>ep,oh:()=>et,qG:()=>tH,rL:()=>tG,tm:()=>en,zY:()=>x});var a,o,s,n,i,l,u,p,c,d,m,h,f,y,v=r(59309),g=r(99143),I=r(13201),b=Object.defineProperty,E="AI_NoOutputSpecifiedError",T=`vercel.ai.error.${E}`,w=Symbol.for(T),x=class extends g.bD{constructor({message:e="No output specified."}={}){super({name:E,message:e}),this[a]=!0}static isInstance(e){return g.bD.hasMarker(e,T)}};a=w;var S=!1,j=e=>{if(0===e.length)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(!1!==t){if("function"==typeof t)return void t(e);for(let t of(S||(S=!0,console.info("AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.")),e))console.warn(function(e){let t="AI SDK Warning:";switch(e.type){case"unsupported-setting":{let r=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case"unsupported-tool":{let r="name"in e.tool?e.tool.name:"unknown tool",a=`${t} The tool "${r}" is not supported by this model`;return e.details&&(a+=` - ${e.details}`),a}case"other":return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}(t))}},N="AI_InvalidArgumentError",A=`vercel.ai.error.${N}`,R=Symbol.for(A),_=class extends g.bD{constructor({parameter:e,value:t,message:r}){super({name:N,message:`Invalid argument for parameter ${e}: ${r}`}),this[o]=!0,this.parameter=e,this.value=t}static isInstance(e){return g.bD.hasMarker(e,A)}};o=R;var k=Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");g.bD;var O="AI_InvalidToolInputError",M=`vercel.ai.error.${O}`,Y=Symbol.for(M),C=class extends g.bD{constructor({toolInput:e,toolName:t,cause:r,message:a=`Invalid input for tool ${t}: ${(0,g.u1)(r)}`}){super({name:O,message:a,cause:r}),this[s]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return g.bD.hasMarker(e,M)}};s=Y;var D="AI_NoImageGeneratedError",$=`vercel.ai.error.${D}`,L=Symbol.for($),P=class extends g.bD{constructor({message:e="No image generated.",cause:t,responses:r}){super({name:D,message:e,cause:t}),this[n]=!0,this.responses=r}static isInstance(e){return g.bD.hasMarker(e,$)}};n=L;var U="AI_NoObjectGeneratedError",F=`vercel.ai.error.${U}`,B=Symbol.for(F),J=class extends g.bD{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:o,finishReason:s}){super({name:U,message:e,cause:t}),this[i]=!0,this.text=r,this.response=a,this.usage=o,this.finishReason=s}static isInstance(e){return g.bD.hasMarker(e,F)}};i=B;var z="AI_NoOutputGeneratedError",V=`vercel.ai.error.${z}`,K=Symbol.for(V),Z=class extends g.bD{constructor({message:e="No output generated.",cause:t}={}){super({name:z,message:e,cause:t}),this[l]=!0}static isInstance(e){return g.bD.hasMarker(e,V)}};l=K,g.bD;var q="AI_NoSuchToolError",W=`vercel.ai.error.${q}`,G=Symbol.for(W),H=class extends g.bD{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:q,message:r}),this[u]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return g.bD.hasMarker(e,W)}};u=G;var Q="AI_ToolCallRepairError",X=`vercel.ai.error.${Q}`,ee=Symbol.for(X),et=class extends g.bD{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${(0,g.u1)(e)}`}){super({name:Q,message:r,cause:e}),this[p]=!0,this.originalError=t}static isInstance(e){return g.bD.hasMarker(e,X)}};p=ee;var er=class extends g.bD{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},ea="AI_InvalidDataContentError",eo=`vercel.ai.error.${ea}`,es=Symbol.for(eo),en=class extends g.bD{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:ea,message:r,cause:t}),this[c]=!0,this.content=e}static isInstance(e){return g.bD.hasMarker(e,eo)}};c=es;var ei="AI_InvalidMessageRoleError",el=`vercel.ai.error.${ei}`,eu=Symbol.for(el),ep=class extends g.bD{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:ei,message:t}),this[d]=!0,this.role=e}static isInstance(e){return g.bD.hasMarker(e,el)}};d=eu;var ec="AI_MessageConversionError",ed=`vercel.ai.error.${ec}`,em=Symbol.for(ed),eh=class extends g.bD{constructor({originalMessage:e,message:t}){super({name:ec,message:t}),this[m]=!0,this.originalMessage=e}static isInstance(e){return g.bD.hasMarker(e,ed)}};m=em;var ef="AI_DownloadError",ey=`vercel.ai.error.${ef}`,ev=Symbol.for(ey),eg=class extends g.bD{constructor({url:e,statusCode:t,statusText:r,cause:a,message:o=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:ef,message:o,cause:a}),this[h]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return g.bD.hasMarker(e,ey)}};h=ev;var eI="AI_RetryError",eb=`vercel.ai.error.${eI}`,eE=Symbol.for(eb),eT=class extends g.bD{constructor({message:e,reason:t,errors:r}){super({name:eI,message:e}),this[f]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return g.bD.hasMarker(e,eb)}};function ew(e){if("string"!=typeof e){if("v2"!==e.specificationVersion)throw new er({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return e}return ex().languageModel(e)}function ex(){var e;return null!=(e=globalThis.AI_SDK_DEFAULT_PROVIDER)?e:gateway}f=eE;var eS=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],ej=e=>{let t="string"==typeof e?convertBase64ToUint8Array(e):e,r=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(r+10)},eN="5.0.93",eA=async({url:e})=>{var t;let r=e.toString();try{let e=await fetch(r,{headers:withUserAgentSuffix({},`ai-sdk/${eN}`,getRuntimeEnvironmentUserAgent())});if(!e.ok)throw new eg({url:r,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(eg.isInstance(e))throw e;throw new eg({url:r,cause:e})}},eR=(e=eA)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t))),e_=I.KC([I.Yj(),I.Nl(Uint8Array),I.Nl(ArrayBuffer),I.Ie(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function ek(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:r}=function(e){try{let[t,r]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==r)throw new AISDKError18({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:r,mediaType:t}}return{data:e,mediaType:void 0}}async function eO({prompt:e,supportedUrls:t,download:r=eR()}){let a=await eM(e.messages,r,t);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function({message:e,downloadedAssets:t}){let r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"user",content:e.content.map(e=>(function(e,t){var r;let a;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let o=e.type;switch(o){case"image":a=e.image;break;case"file":a=e.data;break;default:throw Error(`Unsupported part type: ${o}`)}let{data:s,mediaType:n}=ek(a),i=null!=n?n:e.mediaType,l=s;if(l instanceof URL){let e=t[l.toString()];e&&(l=e.data,null!=i||(i=e.mediaType))}switch(o){case"image":return(l instanceof Uint8Array||"string"==typeof l)&&(i=null!=(r=function({data:e,signatures:t}){let r="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?ej(e):e,a="string"==typeof r?convertBase64ToUint8Array(r.substring(0,Math.min(r.length,24))):r;for(let e of t)if(a.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>null===e||a[t]===e))return e.mediaType}({data:l,signatures:eS}))?r:i),{type:"file",mediaType:null!=i?i:"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":if(null==i)throw Error("Media type is missing for file part");return{type:"file",mediaType:i,filename:e.filename,data:l,providerOptions:e.providerOptions}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text||null!=e.providerOptions).map(e=>{let t=e.providerOptions;switch(e.type){case"file":{let{data:r,mediaType:a}=ek(e.data);return{type:"file",data:r,filename:e.filename,mediaType:null!=a?a:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:e.output,providerOptions:e.providerOptions})),providerOptions:e.providerOptions};default:throw new ep({role:r})}})({message:e,downloadedAssets:a}))]}async function eM(e,t,r){let a=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let r=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,a="image"===e.type?e.image:e.data;if("string"==typeof a)try{a=new URL(a)}catch(e){}return{mediaType:r,data:a}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:null!=e.mediaType&&isUrlSupported({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:r})}));return Object.fromEntries((await t(a)).map((e,t)=>null==e?null:[a[t].url.toString(),{data:e.data,mediaType:e.mediaType}]).filter(e=>null!=e))}function eY({maxOutputTokens:e,temperature:t,topP:r,topK:a,presencePenalty:o,frequencyPenalty:s,seed:n,stopSequences:i}){if(null!=e){if(!Number.isInteger(e))throw new _({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new _({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new _({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new _({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new _({parameter:"topK",value:a,message:"topK must be a number"});if(null!=o&&"number"!=typeof o)throw new _({parameter:"presencePenalty",value:o,message:"presencePenalty must be a number"});if(null!=s&&"number"!=typeof s)throw new _({parameter:"frequencyPenalty",value:s,message:"frequencyPenalty must be a number"});if(null!=n&&!Number.isInteger(n))throw new _({parameter:"seed",value:n,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:r,topK:a,presencePenalty:o,frequencyPenalty:s,stopSequences:i,seed:n}}function eC({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"dynamic":case"function":return{type:"function",name:e,description:t.description,inputSchema:asSchema(t.inputSchema).jsonSchema,providerOptions:t.providerOptions};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}var eD=I.RZ(()=>I.KC([I.ch(),I.Yj(),I.ai(),I.zM(),I.g1(I.Yj(),eD),I.YO(eD)])),e$=I.g1(I.Yj(),I.g1(I.Yj(),eD)),eL=I.Ik({type:I.eu("text"),text:I.Yj(),providerOptions:e$.optional()}),eP=I.Ik({type:I.eu("image"),image:I.KC([e_,I.Nl(URL)]),mediaType:I.Yj().optional(),providerOptions:e$.optional()}),eU=I.Ik({type:I.eu("file"),data:I.KC([e_,I.Nl(URL)]),filename:I.Yj().optional(),mediaType:I.Yj(),providerOptions:e$.optional()}),eF=I.Ik({type:I.eu("reasoning"),text:I.Yj(),providerOptions:e$.optional()}),eB=I.Ik({type:I.eu("tool-call"),toolCallId:I.Yj(),toolName:I.Yj(),input:I.L5(),providerOptions:e$.optional(),providerExecuted:I.zM().optional()}),eJ=I.gM("type",[I.Ik({type:I.eu("text"),value:I.Yj()}),I.Ik({type:I.eu("json"),value:eD}),I.Ik({type:I.eu("error-text"),value:I.Yj()}),I.Ik({type:I.eu("error-json"),value:eD}),I.Ik({type:I.eu("content"),value:I.YO(I.KC([I.Ik({type:I.eu("text"),text:I.Yj()}),I.Ik({type:I.eu("media"),data:I.Yj(),mediaType:I.Yj()})]))})]),ez=I.Ik({type:I.eu("tool-result"),toolCallId:I.Yj(),toolName:I.Yj(),output:eJ,providerOptions:e$.optional()}),eV=I.Ik({role:I.eu("system"),content:I.Yj(),providerOptions:e$.optional()}),eK=I.Ik({role:I.eu("user"),content:I.KC([I.Yj(),I.YO(I.KC([eL,eP,eU]))]),providerOptions:e$.optional()}),eZ=I.Ik({role:I.eu("assistant"),content:I.KC([I.Yj(),I.YO(I.KC([eL,eU,eF,eB,ez]))]),providerOptions:e$.optional()}),eq=I.Ik({role:I.eu("tool"),content:I.YO(ez),providerOptions:e$.optional()}),eW=I.KC([eV,eK,eZ,eq]);async function eG(e){let t;if(null==e.prompt&&null==e.messages)throw new InvalidPromptError2({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new InvalidPromptError2({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new InvalidPromptError2({prompt:e,message:"system must be a string"});if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else if(null!=e.messages)t=e.messages;else throw new InvalidPromptError2({prompt:e,message:"prompt or messages must be defined"});if(0===t.length)throw new InvalidPromptError2({prompt:e,message:"messages must not be empty"});let r=await safeValidateTypes({value:t,schema:z6.array(eW)});if(!r.success)throw new InvalidPromptError2({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:r.error});return{messages:t,system:e.system}}function eH(e){return GatewayAuthenticationError.isInstance(e)||GatewayModelNotFoundError.isInstance(e)?new AISDKError19({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:e}):e}function eQ({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function eX({model:e,settings:t,telemetry:r,headers:a}){var o;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(o=null==r?void 0:r.metadata)?o:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var e0={startSpan:()=>e1,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(e1):"function"==typeof r?r(e1):"function"==typeof a?a(e1):void 0},e1={spanContext:()=>e2,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},e2={traceId:"",spanId:"",traceFlags:0};function e8({isEnabled:e=!1,tracer:t}={}){return e?t||trace.getTracer("ai"):e0}function e5({name:e,tracer:t,attributes:r,fn:a,endWhenDone:o=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return o&&e.end(),t}catch(t){try{e7(e,t)}finally{e.end()}throw t}})}function e7(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:SpanStatusCode.ERROR,message:t.message})):e.setStatus({code:SpanStatusCode.ERROR})}function e4({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(null==a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let o=a.input();return null==o?t:{...t,[r]:o}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let o=a.output();return null==o?t:{...t,[r]:o}}return{...t,[r]:a}},{})}function e6(e){return JSON.stringify(e.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{var t;return"file"===e.type?{...e,data:e.data instanceof Uint8Array?"string"==typeof(t=e.data)?t:t instanceof ArrayBuffer?convertUint8ArrayToBase64(new Uint8Array(t)):convertUint8ArrayToBase64(t):e.data}:e})})))}function e3(e,t){return{inputTokens:e9(e.inputTokens,t.inputTokens),outputTokens:e9(e.outputTokens,t.outputTokens),totalTokens:e9(e.totalTokens,t.totalTokens),reasoningTokens:e9(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:e9(e.cachedInputTokens,t.cachedInputTokens)}}function e9(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}function te(e){return void 0===e?[]:Array.isArray(e)?e:[e]}var tt=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2,abortSignal:a}={})=>async o=>tr(o,{maxRetries:e,delayInMs:t,backoffFactor:r,abortSignal:a});async function tr(e,{maxRetries:t,delayInMs:r,backoffFactor:a,abortSignal:o},s=[]){try{return await e()}catch(u){if(isAbortError(u)||0===t)throw u;let n=getErrorMessage3(u),i=[...s,u],l=i.length;if(l>t)throw new eT({message:`Failed after ${l} attempts. Last error: ${n}`,reason:"maxRetriesExceeded",errors:i});if(u instanceof Error&&APICallError2.isInstance(u)&&!0===u.isRetryable&&l<=t)return await delay(function({error:e,exponentialBackoffDelay:t}){let r,a=e.responseHeaders;if(!a)return t;let o=a["retry-after-ms"];if(o){let e=parseFloat(o);Number.isNaN(e)||(r=e)}let s=a["retry-after"];if(s&&void 0===r){let e=parseFloat(s);r=Number.isNaN(e)?Date.parse(s)-Date.now():1e3*e}return null!=r&&!Number.isNaN(r)&&0<=r&&(r<6e4||r<t)?r:t}({error:u,exponentialBackoffDelay:r}),{abortSignal:o}),tr(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a,abortSignal:o},i);if(1===l)throw u;throw new eT({message:`Failed after ${l} attempts with non-retryable error: '${n}'`,reason:"errorNotRetryable",errors:i})}}function ta({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new _({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new _({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let r=null!=e?e:2;return{maxRetries:r,retry:tt({maxRetries:r,abortSignal:t})}}function to(e){let t=e.filter(e=>"text"===e.type);if(0!==t.length)return t.map(e=>e.text).join("")}var ts=class{constructor({data:e,mediaType:t}){let r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,v.n_)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,v.Z9)(this.base64Data)),this.uint8ArrayData}},tn=class extends ts{constructor(e){super(e),this.type="file"}};async function ti({toolCall:e,tools:t,repairToolCall:r,system:a,messages:o}){try{if(null==t)throw new H({toolName:e.toolName});try{return await tl({toolCall:e,tools:t})}catch(n){if(null==r||!(H.isInstance(n)||C.isInstance(n)))throw n;let s=null;try{s=await r({toolCall:e,tools:t,inputSchema:({toolName:e})=>{let{inputSchema:r}=t[e];return asSchema2(r).jsonSchema},system:a,messages:o,error:n})}catch(e){throw new et({cause:e,originalError:n})}if(null==s)throw n;return await tl({toolCall:s,tools:t})}}catch(a){let t=await safeParseJSON({text:e.input}),r=t.success?t.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:r,dynamic:!0,invalid:!0,error:a}}}async function tl({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new H({toolName:e.toolName,availableTools:Object.keys(t)});let o=asSchema2(a.inputSchema),s=""===e.input.trim()?await safeValidateTypes2({value:{},schema:o}):await safeParseJSON({text:e.input,schema:o});if(!1===s.success)throw new C({toolName:r,toolInput:e.input,cause:s.error});return"dynamic"===a.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:r,input:s.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var tu=class{constructor({content:e,finishReason:t,usage:r,warnings:a,request:o,response:s,providerMetadata:n}){this.content=e,this.finishReason=t,this.usage=r,this.warnings=a,this.request=o,this.response=s,this.providerMetadata=n}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!0!==e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!0!==e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};async function tp({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}function tc({output:e,tool:t,errorMode:r}){return"text"===r?{type:"error-text",value:getErrorMessage4(e)}:"json"===r?{type:"error-json",value:td(e)}:(null==t?void 0:t.toModelOutput)?t.toModelOutput(e):"string"==typeof e?{type:"text",value:e}:{type:"json",value:td(e)}}function td(e){return void 0===e?null:e}function tm({content:e,tools:t}){let r=[],a=e.filter(e=>"source"!==e.type).filter(e=>("tool-result"!==e.type||e.providerExecuted)&&("tool-error"!==e.type||e.providerExecuted)).filter(e=>"text"!==e.type||e.text.length>0).map(e=>{switch(e.type){case"text":return{type:"text",text:e.text,providerOptions:e.providerMetadata};case"reasoning":return{type:"reasoning",text:e.text,providerOptions:e.providerMetadata};case"file":return{type:"file",data:e.file.base64,mediaType:e.file.mediaType,providerOptions:e.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:e.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tc({tool:null==t?void 0:t[e.toolName],output:e.output,errorMode:"none"}),providerExecuted:!0,providerOptions:e.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tc({tool:null==t?void 0:t[e.toolName],output:e.error,errorMode:"json"}),providerOptions:e.providerMetadata}}});a.length>0&&r.push({role:"assistant",content:a});let o=e.filter(e=>"tool-result"===e.type||"tool-error"===e.type).filter(e=>!e.providerExecuted).map(e=>({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:tc({tool:null==t?void 0:t[e.toolName],output:"tool-result"===e.type?e.output:e.error,errorMode:"tool-error"===e.type?"text":"none"})}));return o.length>0&&r.push({role:"tool",content:o}),r}var th=(0,v.hK)({prefix:"aitxt",size:24});async function tf({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:o,abortSignal:s,experimental_context:n}){return(await Promise.all(e.map(async({toolCallId:e,toolName:i,input:l})=>{let u=t[i];if((null==u?void 0:u.execute)!=null)return e5({name:"ai.toolCall",attributes:e4({telemetry:a,attributes:{...eQ({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":i,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(l)}}}),tracer:r,fn:async t=>{try{let r;for await(let t of executeTool({execute:u.execute.bind(u),input:l,options:{toolCallId:e,messages:o,abortSignal:s,experimental_context:n}}))"final"===t.type&&(r=t.output);try{t.setAttributes(e4({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return{type:"tool-result",toolCallId:e,toolName:i,input:l,output:r,dynamic:"dynamic"===u.type}}catch(r){return e7(t,r),{type:"tool-error",toolCallId:e,toolName:i,input:l,error:r,dynamic:"dynamic"===u.type}}}})}))).filter(e=>null!=e)}var ty=class{constructor(e){this.steps=e.steps,this.resolvedOutput=e.resolvedOutput}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get totalUsage(){return this.steps.reduce((e,t)=>e3(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0})}get experimental_output(){if(null==this.resolvedOutput)throw new x;return this.resolvedOutput}};function tv(e){let t=e.filter(e=>"tool-call"===e.type);if(0!==t.length)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function tg(e,t){let r=new Headers(null!=e?e:{});for(let[e,a]of Object.entries(t))r.has(e)||r.set(e,a);return r}function tI({status:e,statusText:t,headers:r,textStream:a}){return new Response(a.pipeThrough(new TextEncoderStream),{status:null!=e?e:200,statusText:t,headers:tg(r,{"content-type":"text/plain; charset=utf-8"})})}function tb({response:e,status:t,statusText:r,headers:a,stream:o}){e.writeHead(null!=t?t:200,r,a);let s=o.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await s.read();if(t)break;e.write(r)||await new Promise(t=>{e.once("drain",t)})}}catch(e){throw e}finally{e.end()}})()}function tE({response:e,status:t,statusText:r,headers:a,textStream:o}){tb({response:e,status:t,statusText:r,headers:Object.fromEntries(tg(a,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:o.pipeThrough(new TextEncoderStream)})}var tT=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue("data: [DONE]\n\n")}})}},tw={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"},tx=(0,v.fE)(()=>(0,v.jN)(I.KC([I.re({type:I.eu("text-start"),id:I.Yj(),providerMetadata:e$.optional()}),I.re({type:I.eu("text-delta"),id:I.Yj(),delta:I.Yj(),providerMetadata:e$.optional()}),I.re({type:I.eu("text-end"),id:I.Yj(),providerMetadata:e$.optional()}),I.re({type:I.eu("error"),errorText:I.Yj()}),I.re({type:I.eu("tool-input-start"),toolCallId:I.Yj(),toolName:I.Yj(),providerExecuted:I.zM().optional(),dynamic:I.zM().optional()}),I.re({type:I.eu("tool-input-delta"),toolCallId:I.Yj(),inputTextDelta:I.Yj()}),I.re({type:I.eu("tool-input-available"),toolCallId:I.Yj(),toolName:I.Yj(),input:I.L5(),providerExecuted:I.zM().optional(),providerMetadata:e$.optional(),dynamic:I.zM().optional()}),I.re({type:I.eu("tool-input-error"),toolCallId:I.Yj(),toolName:I.Yj(),input:I.L5(),providerExecuted:I.zM().optional(),providerMetadata:e$.optional(),dynamic:I.zM().optional(),errorText:I.Yj()}),I.re({type:I.eu("tool-output-available"),toolCallId:I.Yj(),output:I.L5(),providerExecuted:I.zM().optional(),dynamic:I.zM().optional(),preliminary:I.zM().optional()}),I.re({type:I.eu("tool-output-error"),toolCallId:I.Yj(),errorText:I.Yj(),providerExecuted:I.zM().optional(),dynamic:I.zM().optional()}),I.re({type:I.eu("reasoning-start"),id:I.Yj(),providerMetadata:e$.optional()}),I.re({type:I.eu("reasoning-delta"),id:I.Yj(),delta:I.Yj(),providerMetadata:e$.optional()}),I.re({type:I.eu("reasoning-end"),id:I.Yj(),providerMetadata:e$.optional()}),I.re({type:I.eu("source-url"),sourceId:I.Yj(),url:I.Yj(),title:I.Yj().optional(),providerMetadata:e$.optional()}),I.re({type:I.eu("source-document"),sourceId:I.Yj(),mediaType:I.Yj(),title:I.Yj(),filename:I.Yj().optional(),providerMetadata:e$.optional()}),I.re({type:I.eu("file"),url:I.Yj(),mediaType:I.Yj(),providerMetadata:e$.optional()}),I.re({type:I.Ie(e=>"string"==typeof e&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:I.Yj().optional(),data:I.L5(),transient:I.zM().optional()}),I.re({type:I.eu("start-step")}),I.re({type:I.eu("finish-step")}),I.re({type:I.eu("start"),messageId:I.Yj().optional(),messageMetadata:I.L5().optional()}),I.re({type:I.eu("finish"),finishReason:I.k5(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:I.L5().optional()}),I.re({type:I.eu("abort")}),I.re({type:I.eu("message-metadata"),messageMetadata:I.L5()})])));async function tS(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,v.N8)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,v.N8)({text:function(e){let t=["ROOT"],r=-1,a=null;function o(e,o,s){switch(e){case'"':r=o,t.pop(),t.push(s),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=o,a=o,t.pop(),t.push(s),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o,t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"{":r=o,t.pop(),t.push(s),t.push("INSIDE_OBJECT_START");break;case"[":r=o,t.pop(),t.push(s),t.push("INSIDE_ARRAY_START")}}function s(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function n(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let i=0;i<e.length;i++){let l=e[i];switch(t[t.length-1]){case"ROOT":o(l,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(l,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(l,i);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=i}break;case"INSIDE_ARRAY_START":"]"===l?(r=i,t.pop()):(r=i,o(l,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=i,t.pop();break;default:r=i}break;case"INSIDE_ARRAY_AFTER_COMMA":o(l,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=i;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&n(l,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&n(l,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(a,i+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?r=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?s(l,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&n(l,i))}}}let i=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return i}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function tj(e){return e.type.startsWith("tool-")}function tN(e){return tj(e)||"dynamic-tool"===e.type}function tA(e){return e.type.split("-").slice(1).join("-")}function tR(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function r(r){var a;t=!0;try{r&&await (null==(a=e.cancel)?void 0:a.call(e))}finally{try{e.releaseLock()}catch(e){}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:a,value:o}=await e.read();return a?(await r(!0),{done:!0,value:void 0}):{done:!1,value:o}},return:async()=>(await r(!0),{done:!0,value:void 0}),async throw(e){throw await r(!0),e}}},t}async function t_({stream:e,onError:t}){let r=e.getReader();try{for(;;){let{done:e}=await r.read();if(e)break}}catch(e){null==t||t(e)}finally{r.releaseLock()}}function tk(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function tO(){let e=[],t=null,r=!1,a=tk(),o=()=>{r=!0,a.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()},s=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return a=tk(),await a.promise,s();try{let{value:a,done:o}=await e[0].read();o?(e.shift(),e.length>0?await s():r&&(null==t||t.close())):null==t||t.enqueue(a)}catch(r){null==t||t.error(r),e.shift(),o()}};return{stream:new ReadableStream({start(e){t=e},pull:s,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),a.resolve()},close:()=>{r=!0,a.resolve(),0===e.length&&(null==t||t.close())},terminate:o}}var tM=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this._promise}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&(null==(t=this._reject)||t.call(this,e))}};(0,v.hK)({prefix:"aitxt",size:24});var tY={type:"no-schema",jsonSchema:void 0,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async(e,t)=>void 0===e?{success:!1,error:new J({message:"No object generated: response did not match schema.",text:t.text,response:t.response,usage:t.usage,finishReason:t.finishReason})}:{success:!0,value:e},createElementStream(){throw new g.b8({functionality:"element streams in no-schema mode"})}},tC=e=>({type:"object",jsonSchema:e.jsonSchema,validatePartialResult:async({value:e,textDelta:t})=>({success:!0,value:{partial:e,textDelta:t}}),validateFinalResult:async t=>safeValidateTypes3({value:t,schema:e}),createElementStream(){throw new UnsupportedFunctionalityError2({functionality:"element streams in object mode"})}}),tD=e=>{let{$schema:t,...r}=e.jsonSchema;return{type:"array",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},async validatePartialResult({value:t,latestObject:r,isFirstDelta:a,isFinalDelta:o}){var s;if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError2({value:t,cause:"value must be an object that contains an array of elements"})};let n=t.elements,i=[];for(let t=0;t<n.length;t++){let r=n[t],a=await safeValidateTypes3({value:r,schema:e});if(t!==n.length-1||o){if(!a.success)return a;i.push(a.value)}}let l=null!=(s=null==r?void 0:r.length)?s:0,u="";return a&&(u+="["),l>0&&(u+=","),u+=i.slice(l).map(e=>JSON.stringify(e)).join(","),o&&(u+="]"),{success:!0,value:{partial:i,textDelta:u}}},async validateFinalResult(t){if(!isJSONObject(t)||!isJSONArray(t.elements))return{success:!1,error:new TypeValidationError2({value:t,cause:"value must be an object that contains an array of elements"})};let r=t.elements;for(let t of r){let r=await safeValidateTypes3({value:t,schema:e});if(!r.success)return r}return{success:!0,value:r}},createElementStream(e){let t=0;return tR(e.pipeThrough(new TransformStream({transform(e,r){switch(e.type){case"object":{let a=e.object;for(;t<a.length;t++)r.enqueue(a[t]);break}case"text-delta":case"finish":case"error":break;default:throw Error(`Unsupported chunk type: ${e}`)}}})))}}},t$=e=>({type:"enum",jsonSchema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},async validateFinalResult(t){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError2({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let r=t.result;return e.includes(r)?{success:!0,value:r}:{success:!1,error:new TypeValidationError2({value:t,cause:"value must be a string in the enum"})}},async validatePartialResult({value:t,textDelta:r}){if(!isJSONObject(t)||"string"!=typeof t.result)return{success:!1,error:new TypeValidationError2({value:t,cause:'value must be an object that contains a string in the "result" property.'})};let a=t.result,o=e.filter(e=>e.startsWith(a));return 0===t.result.length||0===o.length?{success:!1,error:new TypeValidationError2({value:t,cause:"value must be a string in the enum"})}:{success:!0,value:{partial:o.length>1?a:o[0],textDelta:r}}},createElementStream(){throw new UnsupportedFunctionalityError2({functionality:"element streams in enum mode"})}});async function tL(e,t,r){let a=await safeParseJSON3({text:e});if(!a.success)throw new J({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let o=await t.validateFinalResult(a.value,{text:e,response:r.response,usage:r.usage});if(!o.success)throw new J({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return o.value}async function tP(e,t,r,a){try{return await tL(e,t,a)}catch(o){if(null!=r&&J.isInstance(o)&&(JSONParseError2.isInstance(o.cause)||TypeValidationError3.isInstance(o.cause))){let s=await r({text:e,error:o.cause});if(null===s)throw o;return await tL(s,t,a)}throw o}}function tU(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if("object"!=typeof e&&"object"!=typeof t)return e===t;if(e.constructor!==t.constructor)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(Array.isArray(e)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!tU(e[r],t[r]))return!1;return!0}let r=Object.keys(e),a=Object.keys(t);if(r.length!==a.length)return!1;for(let o of r)if(!a.includes(o)||!tU(e[o],t[o]))return!1;return!0}(0,v.hK)({prefix:"aiobj",size:24}),(0,v.hK)({prefix:"aiobj",size:24}),((e,t)=>{for(var r in t)b(e,r,{get:t[r],enumerable:!0})})({},{object:()=>tB,text:()=>tF});var tF=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:e})=>({partial:e}),parseOutput:async({text:e})=>e}),tB=({schema:e})=>{let t=(0,v.mD)(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial({text:e}){let t=await tS(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput({text:e},r){let a=await (0,v.N8)({text:e});if(!a.success)throw new J({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let o=await (0,v.ZZ)({value:a.value,schema:t});if(!o.success)throw new J({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return o.value}}},tJ=({model:e,middleware:t,modelId:r,providerId:a})=>[...te(t)].reverse().reduce((e,t)=>tz({model:e,middleware:t,modelId:r,providerId:a}),e),tz=({model:e,middleware:{transformParams:t,wrapGenerate:r,wrapStream:a,overrideProvider:o,overrideModelId:s,overrideSupportedUrls:n},modelId:i,providerId:l})=>{var u,p,c;async function d({params:r,type:a}){return t?await t({params:r,type:a,model:e}):r}return{specificationVersion:"v2",provider:null!=(u=null!=l?l:null==o?void 0:o({model:e}))?u:e.provider,modelId:null!=(p=null!=i?i:null==s?void 0:s({model:e}))?p:e.modelId,supportedUrls:null!=(c=null==n?void 0:n({model:e}))?c:e.supportedUrls,async doGenerate(t){let a=await d({params:t,type:"generate"}),o=async()=>e.doGenerate(a),s=async()=>e.doStream(a);return r?r({doGenerate:o,doStream:s,params:a,model:e}):o()},async doStream(t){let r=await d({params:t,type:"stream"}),o=async()=>e.doGenerate(r),s=async()=>e.doStream(r);return a?a({doGenerate:o,doStream:s,params:r,model:e}):s()}}},tV="AI_NoSuchProviderError",tK=`vercel.ai.error.${tV}`,tZ=Symbol.for(tK),tq=class extends g.eM{constructor({modelId:e,modelType:t,providerId:r,availableProviders:a,message:o=`No such provider: ${r} (available providers: ${a.join()})`}){super({errorName:tV,modelId:e,modelType:t,message:o}),this[y]=!0,this.providerId=r,this.availableProviders=a}static isInstance(e){return g.bD.hasMarker(e,tK)}};y=tZ,g.bD;var tW=class{constructor({api:e="/api/chat",credentials:t,headers:r,body:a,fetch:o,prepareSendMessagesRequest:s,prepareReconnectToStreamRequest:n}){this.api=e,this.credentials=t,this.headers=r,this.body=a,this.fetch=o,this.prepareSendMessagesRequest=s,this.prepareReconnectToStreamRequest=n}async sendMessages({abortSignal:e,...t}){var r,a,o,s,n;let i=await (0,v.hd)(this.body),l=await (0,v.hd)(this.headers),u=await (0,v.hd)(this.credentials),p={...(0,v.qx)(l),...(0,v.qx)(t.headers)},c=await (null==(r=this.prepareSendMessagesRequest)?void 0:r.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...i,...t.body},headers:p,credentials:u,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),d=null!=(a=null==c?void 0:c.api)?a:this.api,m=(null==c?void 0:c.headers)!==void 0?(0,v.qx)(c.headers):p,h=(null==c?void 0:c.body)!==void 0?c.body:{...i,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},f=null!=(o=null==c?void 0:c.credentials)?o:u,y=null!=(s=this.fetch)?s:globalThis.fetch,g=await y(d,{method:"POST",headers:(0,v.WZ)({"Content-Type":"application/json",...m},`ai-sdk/${eN}`,(0,v.G1)()),body:JSON.stringify(h),credentials:f,signal:e});if(!g.ok)throw Error(null!=(n=await g.text())?n:"Failed to fetch the chat response.");if(!g.body)throw Error("The response body is empty.");return this.processResponseStream(g.body)}async reconnectToStream(e){var t,r,a,o,s;let n=await (0,v.hd)(this.body),i=await (0,v.hd)(this.headers),l=await (0,v.hd)(this.credentials),u={...(0,v.qx)(i),...(0,v.qx)(e.headers)},p=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...n,...e.body},headers:u,credentials:l,requestMetadata:e.metadata})),c=null!=(r=null==p?void 0:p.api)?r:`${this.api}/${e.chatId}/stream`,d=(null==p?void 0:p.headers)!==void 0?(0,v.qx)(p.headers):u,m=null!=(a=null==p?void 0:p.credentials)?a:l,h=null!=(o=this.fetch)?o:globalThis.fetch,f=await h(c,{method:"GET",headers:(0,v.WZ)(d,`ai-sdk/${eN}`,(0,v.G1)()),credentials:m});if(204===f.status)return null;if(!f.ok)throw Error(null!=(s=await f.text())?s:"Failed to fetch the chat response.");if(!f.body)throw Error("The response body is empty.");return this.processResponseStream(f.body)}},tG=class extends tW{constructor(e={}){super(e)}processResponseStream(e){return(0,v._Z)({stream:e,schema:tx}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}};function tH({messages:e}){let t=e[e.length-1];if(!t||"assistant"!==t.role)return!1;let r=t.parts.reduce((e,t,r)=>"step-start"===t.type?r:e,-1),a=t.parts.slice(r+1).filter(tN).filter(e=>!e.providerExecuted);return a.length>0&&a.every(e=>"output-available"===e.state||"output-error"===e.state)}var tQ=(0,v.fE)(()=>(0,v.jN)(I.YO(I.Ik({id:I.Yj(),role:I.k5(["system","user","assistant"]),metadata:I.L5().optional(),parts:I.YO(I.KC([I.Ik({type:I.eu("text"),text:I.Yj(),state:I.k5(["streaming","done"]).optional(),providerMetadata:e$.optional()}),I.Ik({type:I.eu("reasoning"),text:I.Yj(),state:I.k5(["streaming","done"]).optional(),providerMetadata:e$.optional()}),I.Ik({type:I.eu("source-url"),sourceId:I.Yj(),url:I.Yj(),title:I.Yj().optional(),providerMetadata:e$.optional()}),I.Ik({type:I.eu("source-document"),sourceId:I.Yj(),mediaType:I.Yj(),title:I.Yj(),filename:I.Yj().optional(),providerMetadata:e$.optional()}),I.Ik({type:I.eu("file"),mediaType:I.Yj(),filename:I.Yj().optional(),url:I.Yj(),providerMetadata:e$.optional()}),I.Ik({type:I.eu("step-start")}),I.Ik({type:I.Yj().startsWith("data-"),id:I.Yj().optional(),data:I.L5()}),I.Ik({type:I.eu("dynamic-tool"),toolName:I.Yj(),toolCallId:I.Yj(),state:I.eu("input-streaming"),input:I.L5().optional(),providerExecuted:I.zM().optional(),output:I.Zm().optional(),errorText:I.Zm().optional()}),I.Ik({type:I.eu("dynamic-tool"),toolName:I.Yj(),toolCallId:I.Yj(),state:I.eu("input-available"),input:I.L5(),providerExecuted:I.zM().optional(),output:I.Zm().optional(),errorText:I.Zm().optional(),callProviderMetadata:e$.optional()}),I.Ik({type:I.eu("dynamic-tool"),toolName:I.Yj(),toolCallId:I.Yj(),state:I.eu("output-available"),input:I.L5(),providerExecuted:I.zM().optional(),output:I.L5(),errorText:I.Zm().optional(),callProviderMetadata:e$.optional(),preliminary:I.zM().optional()}),I.Ik({type:I.eu("dynamic-tool"),toolName:I.Yj(),toolCallId:I.Yj(),state:I.eu("output-error"),input:I.L5(),providerExecuted:I.zM().optional(),output:I.Zm().optional(),errorText:I.Yj(),callProviderMetadata:e$.optional()}),I.Ik({type:I.Yj().startsWith("tool-"),toolCallId:I.Yj(),state:I.eu("input-streaming"),providerExecuted:I.zM().optional(),input:I.L5().optional(),output:I.Zm().optional(),errorText:I.Zm().optional(),approval:I.Zm().optional()}),I.Ik({type:I.Yj().startsWith("tool-"),toolCallId:I.Yj(),state:I.eu("input-available"),providerExecuted:I.zM().optional(),input:I.L5(),output:I.Zm().optional(),errorText:I.Zm().optional(),callProviderMetadata:e$.optional(),approval:I.Zm().optional()}),I.Ik({type:I.Yj().startsWith("tool-"),toolCallId:I.Yj(),state:I.eu("approval-requested"),input:I.L5(),providerExecuted:I.zM().optional(),output:I.Zm().optional(),errorText:I.Zm().optional(),callProviderMetadata:e$.optional(),approval:I.Ik({id:I.Yj(),approved:I.Zm().optional(),reason:I.Zm().optional()})}),I.Ik({type:I.Yj().startsWith("tool-"),toolCallId:I.Yj(),state:I.eu("approval-responded"),input:I.L5(),providerExecuted:I.zM().optional(),output:I.Zm().optional(),errorText:I.Zm().optional(),callProviderMetadata:e$.optional(),approval:I.Ik({id:I.Yj(),approved:I.zM(),reason:I.Yj().optional()})}),I.Ik({type:I.Yj().startsWith("tool-"),toolCallId:I.Yj(),state:I.eu("output-available"),providerExecuted:I.zM().optional(),input:I.L5(),output:I.L5(),errorText:I.Zm().optional(),callProviderMetadata:e$.optional(),preliminary:I.zM().optional(),approval:I.Ik({id:I.Yj(),approved:I.eu(!0),reason:I.Yj().optional()}).optional()}),I.Ik({type:I.Yj().startsWith("tool-"),toolCallId:I.Yj(),state:I.eu("output-error"),providerExecuted:I.zM().optional(),input:I.L5(),output:I.Zm().optional(),errorText:I.Yj(),callProviderMetadata:e$.optional(),approval:I.Ik({id:I.Yj(),approved:I.eu(!0),reason:I.Yj().optional()}).optional()}),I.Ik({type:I.Yj().startsWith("tool-"),toolCallId:I.Yj(),state:I.eu("output-denied"),providerExecuted:I.zM().optional(),input:I.L5(),output:I.Zm().optional(),errorText:I.Zm().optional(),callProviderMetadata:e$.optional(),approval:I.Ik({id:I.Yj(),approved:I.eu(!1),reason:I.Yj().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty")))}}]);